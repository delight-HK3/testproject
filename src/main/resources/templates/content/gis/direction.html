<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">

    <head>
        <th:block th:replace="~{content/common/headScript :: headerScriptFragment}"></th:block>

        <!-- naver Map Script -->
        <script type="text/javascript" th:src="@{${naverMap}}"></script>
        
    </head>

    <body>
        <div class="container">
            <br>
            <input class="form-control" type="text" id="coordinates" name="coordinates" value="">
            <br>
            <div id="naverMap" style="width:100%;height:800px;"></div>

            <script>
                var mapOptions = {
                    center: new naver.maps.LatLng(37.3595704, 127.105399),
                    zoom: 10
                };
                
                var map = new naver.maps.Map('naverMap', mapOptions);

                $.ajax({
                    url: "./directionGps"
                    , type: 'GET'
                    , dataType: 'json'
                    , contentType : 'application/charset=utf-8'
                    , success: function (data) {

                        var markeritem = [];
                        var cnt = 0;

                        var items = data.route.trafast[0].path;

                        var waypoints = data.route.trafast[0].summary.waypoints[0].location;
                        var waypoints2 = data.route.trafast[0].summary.waypoints[1].location;
                    

                        var marker = new naver.maps.Marker({
                            position: new naver.maps.LatLng(waypoints[1], waypoints[0]),
                            map: map
                        });

                        var marker2 = new naver.maps.Marker({
                            position: new naver.maps.LatLng(waypoints2[1], waypoints2[0]),
                            map: map
                        });

                        const path = items.map(([lng, lat]) => new naver.maps.LatLng(lat, lng));

                        const polyline = new naver.maps.Polyline({
                            map: map,
                            path: path,
                            strokeColor: "#33b4ff", // Route color
                            strokeWeight: 4,       // Route width
                            strokeLineCap: "round",
                            startIcon: 3,
                            endIcon: 3
                        });
                    
                        naver.maps.Event.addListener(map, 'click', function(e) {

                            if(markeritem.length == 7){
                                return;
                            }

                            var lat = e.coord.lat(); // Latitude
                            var lng = e.coord.lng(); // Longitude

                            var marker = new naver.maps.Marker({
                                position: new naver.maps.LatLng(lat, lng),
                                map: map
                            });
                            
                            marker.customData = {
                                id: cnt
                            };

                            markeritem.push(`${lng}, ${lat}`);

                            naver.maps.Event.addListener(marker, 'click', function(e) {
                                cnt--;
                                markeritem.splice(marker.customData.id,1);
                                marker.setMap(null);
                                
                                //cnt--;
                                console.log(cnt);
                                console.log(markeritem);
                                return;
                            });

                            cnt++;
                            console.log(cnt);
                            console.log(markeritem);
                            //document.getElementById('coordinates').value = `${lat}, ${lng}`;
                        });

                    }
                });

            </script>

            <th:block th:replace="~{content/common/footer :: footerFragment}"></th:block>
        </div>
    </body>
</html>